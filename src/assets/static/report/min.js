window.tinymce&&reportDataListJson&&reportAvailableFieldsListJson&&reportAvailableFieldsGlobalJson&&tinymce.PluginManager.add("codeupReport",function(a){function b(){$(tinymce.activeEditor.dom.doc).find("body").css("width",REPORT_PAGE_WIDTH+"cm").css("height",REPORT_PAGE_HEIGHT+"cm").css("margin","0 auto"),REPORT_MARGINS&&$(tinymce.activeEditor.dom.doc).find("body").css("padding-left",REPORT_MARGINS.left?REPORT_MARGINS.left+"mm":"1px").css("padding-right",REPORT_MARGINS.right?REPORT_MARGINS.right+"mm":"1px").css("padding-top",REPORT_MARGINS.top?REPORT_MARGINS.top+"mm":"1px").css("padding-bottom",REPORT_MARGINS.bottom?REPORT_MARGINS.bottom+"mm":"1px")}function c(b,d){var e=[];return"undefined"==typeof d&&(d=""),$.each(b,function(b,f){var g=d+b;if(isNaN(b)){var h=b.split(":");b=h[0],h[1]&&(g=h[1])}"string"==typeof f?e.push({text:f,icon:"unlock",onclick:function(){a.insertContent('&nbsp;<span class="field global-field"><field>{%'+d+f+"%}</field></span>&nbsp;")}}):f.constructor===[].constructor&&e.push({text:b,icon:"unlock",menu:c(f,g+".")})}),e}function d(b,c){var e=[];return"undefined"==typeof c&&(c=""),$.each(b,function(b,f){"string"==typeof f?e.push({text:f,icon:"unlock",onclick:function(){a.insertContent('&nbsp;<span class="field global-field"><field>{'+c+f+"}</field></span>&nbsp;")}}):f.constructor===[].constructor&&e.push({text:b,icon:"unlock",menu:d(f,c+b+".")})}),e}function e(a,b){var c=[];return"undefined"==typeof b&&(b=""),$.each(a,function(a,d){"string"==typeof d?c.push({text:d,icon:"unlock",onclick:function(){var a=tinymce.activeEditor.selection.getNode();a.innerHTML.search(":"+b+d)>=0?a.innerHTML=a.innerHTML.split(":"+b+d).join(""):a.innerHTML=a.innerHTML.replace(/{(.*?)}/gi,function(a){var c=a.substr(a.length-2);return"%}"===c?a.substr(0,a.length-2)+":"+b+d+"%}":a.substr(0,a.length-1)+":"+b+d+"}"}),tinymce.activeEditor.selection.setNode(a)}}):(d.constructor===[].constructor||d.constructor==={}.constructor)&&c.push({text:a,icon:"unlock",menu:e(d,b+a+".")})}),c}function f(b,c){var d=[];return"undefined"==typeof c&&(c=""),$.each(b,function(b,e){"string"==typeof e?d.push({text:e,icon:"unlock",onclick:function(){g.currentPath&&(g.currentPath.attr("condition")&&g.currentPath.attr("condition")===e?g.currentPath.removeAttr("condition"):g.currentPath.attr("condition",e))},onpostrender:function(){var b=this;a.on("click",function(a){var c=g.currentPath.closest("[condition]").attr("condition");c&&c===e?b.active(!0):b.active(!1)})}}):e.constructor===[].constructor&&d.push({text:b,icon:"unlock",menu:f(e,c+b+".")})}),d}var g={currentConditionPath:null,currentNode:null,currentPath:null,dataListToggleToolbar:[],currentClassListPath:"",currentField:null};a.on("NodeChange",function(a){g.currentNode=a;var b=$(a.element);if(g.currentPath=$(b),b.hasClass("field")||b.hasClass("mceNonEditable")){var c=tinymce.activeEditor.selection.getNode();tinymce.activeEditor.selection.select($(c).closest(".field")[0]),g.currentField=b}else g.currentField=null;b.attr("report-list")?g.currentClassListPath=b:g.currentClassListPath=null}),REPORT_PAGE_WIDTH&&REPORT_PAGE_HEIGHT&&(a.on("init",b),a.addButton("toggleWidth",{text:"Toggle Size",active:!0,onclick:function(){this.active()?($(tinymce.activeEditor.dom.doc).find("body").css("width","auto").css("height",REPORT_PAGE_HEIGHT+"cm").css("margin","auto"),this.active(!1)):(b(),this.active(!0))}})),$.each(reportDataListJson,function(b,c){a.addButton("toggleClassLists_"+b,{text:"(LIST) "+b,onclick:function(){g.currentPath&&(this.active()?(g.currentPath.removeAttr("report-list"),this.active(!1)):(g.currentPath.attr("report-list",b),this.active(!0)))},onpostrender:function(){var c=this;a.on("NodeChange",function(a){g.currentPath.closest("[report-list]").attr("report-list")&&g.currentPath.closest("[report-list]").attr("report-list")===b?c.active(!0):c.active(!1)})}})}),$.each(reportAvailableFieldsListJson,function(b,d){a.addButton("fieldList_"+b.replace(/ /g,"-"),{type:"menubutton",text:"(LIST Field) "+b,icon:!1,menu:c(d),disabled:!0,onpostrender:function(){var c=this;a.on("NodeChange",function(a){g.currentPath.closest("[report-list]").attr("report-list")===b?c.disabled(!1):c.disabled(!0)})}})}),$.each(reportAvailableFieldsGlobalJson,function(b,c){a.addButton("fieldGlobal_"+b.replace(/ /g,"-"),{type:"menubutton",text:"(GLOBAL Field) "+b,icon:!1,menu:d(c,b.replace(/ /g,"-")+"."),onpostrender:function(){a.on("click",function(a){})}})}),a.addButton("codeup_formatters",{type:"menubutton",text:"(Formatters)",icon:!1,menu:e(reportFormatters),disabled:!0,onpostrender:function(){var b=this;a.on("NodeChange",function(a){var c=tinymce.activeEditor.selection.getNode();$(c).hasClass("field")?b.disabled(!1):b.disabled(!0)})}});var h=f(reportAvailableFieldsConditionJson);a.addButton("codeup_conditions",{type:"menubutton",text:"(Conditions)",icon:!1,menu:h,onpostrender:function(){var b=this;a.on("click",function(a){var c=$(a.path[0]);"HTML"!==c.prop("tagName")&&"BODY"!==c.prop("tagName")?(b.disabled(!1),g.currentConditionPath=c):b.disabled(!0),g.currentPath.closest("[condition]").attr("condition")?b.active(!0):b.active(!1)})}})});